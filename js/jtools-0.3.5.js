/* Various tools for hiragana, katakana and kanji input: virtual keyboard, client-side kanji recognition. 2018-07-16 */
"use strict";function onLoad(){var a=new Panels;JTOOLS.showLoader=function(){document.getElementById("footer").classList.add("loading")},JTOOLS.hideLoader=function(){document.getElementById("footer").classList.remove("loading")},JTOOLS.createPicker=a.createPicker,a.initPanel("kb",function(){JTOOLS.showLoader(),sendRequest("keyboard.html",function(b){var c=localStorage.getItem("kb.x"),d=localStorage.getItem("kb.y"),e=a.createPanel("kb",c?c+"px":"40px",d?d+"px":"40px");e.innerHTML=b,JTOOLS.keyboard=new Keyboard,e.style.display="block",JTOOLS.hideLoader()})}),a.initPanel("recog",function(){JTOOLS.showLoader(),sendRequest("recognition.html",function(b){var c=localStorage.getItem("recog.x"),d=localStorage.getItem("recog.y"),e=a.createPanel("recog",c?c+"px":"396px",d?d+"px":"248px");e.innerHTML=b,e.style.display="block",new Sliders,JTOOLS.recognition=new Recognition(null,function(a){JTOOLS.keyboard&&JTOOLS.keyboard.addSymbol(a)}),JTOOLS.handwriting=new Handwriting(JTOOLS.recognition.recognize),JTOOLS.hideLoader()})}),a.initPanel("kakijun",function(){JTOOLS.showLoader(),sendRequest("kakijun.html",function(b){var c=localStorage.getItem("kakijun.x"),d=localStorage.getItem("kakijun.y"),e=a.createPanel("kakijun",c?c+"px":"426px",d?d+"px":"258px");e.innerHTML=b,e.style.display="block",JTOOLS.hideLoader()})}),a.hasSavedPanes()||(a.loadPanel("kb"),a.loadPanel("recog"))}function message(a,b){var c=document.getElementById("message");c||(c=document.createElement("div"),c.setAttribute("id","message"),document.body.insertBefore(c,null)),b||(b="info"),c.innerHTML='<div class="'+b+'">'+a+"</div>",c.style.display="block",c.onclick=function(){c.style.display="none"}}function ColorPicker(){function a(a,b,c){function d(a,b,d){var f=e(a,b,d),g="rgb("+f[0]+","+f[1]+","+f[2]+")";h=document.createElement("button"),h.className="color",h.style.backgroundColor=g,h.onclick=function(){i.removePicker(),c(g)},i.appendChild(h)}function e(a,b,c){function d(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+6*(b-a)*(2/3-c):a}var e,f,g;if(0==b)e=f=g=c;else{var h=.5>c?c*(1+b):c+b-c*b,i=2*c-h;e=d(i,h,a+1/3),f=d(i,h,a),g=d(i,h,a-1/3)}return[Math.round(255*e),Math.round(255*f),Math.round(255*g)]}var f,g,h,i=JTOOLS.createPicker("colorpicker",a,b);for(f=0;100>=f;f+=5)d(f/100,1,.75);for(i.appendChild(document.createElement("br")),f=0;100>=f;f+=5)d(f/100,1,.5);for(i.appendChild(document.createElement("br")),f=0;100>=f;f+=5)d(f/100,1,.25);for(i.appendChild(document.createElement("br")),g=0;100>=g;g+=5)d(0,0,g/100);i.appendChild(document.createElement("br"));var j=document.createElement("button");return j.className="randomColor",j.innerHTML="Random color",j.onclick=function(){i.removePicker(),c("random")},i.appendChild(j),i}this.showAtElement=function(b,c){var d=b.getBoundingClientRect();return a(d.left,b.offsetHeight+d.top,c)}}function setDraggable(a){function b(b){1!=b.which||DRAG_TAGS_IGNORE.indexOf(b.target.tagName.toLowerCase())>-1||b.target.classList.contains("no-drag")||(e=b.clientX-a.getBoundingClientRect().left,f=b.clientY-a.getBoundingClientRect().top,document.addEventListener("mousemove",d),document.addEventListener("mouseup",c),document.body.classList.add("unselectable"))}function c(){localStorage.setItem(a.id+".x",a.getBoundingClientRect().left),localStorage.setItem(a.id+".y",a.getBoundingClientRect().top),document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",c),document.body.classList.remove("unselectable")}function d(b){a.style.left=b.clientX-e+"px",a.style.top=b.clientY-f+"px"}var e,f;a.addEventListener("mousedown",b)}function Handwriting(a){function b(a){var b=0;return b="wheelDelta"in a?a.wheelDelta:-a.detail,b>0?jb.valueUp():jb.valueDown(),a.preventDefault(),!1}function c(a,b,c){var d=document.createElementNS("http://www.w3.org/2000/svg",b);return c?a.insertBefore(d,a.firstChild):a.appendChild(d),d.attrs=function(a){for(var b in a)a.hasOwnProperty(b)&&d.setAttribute(b,a[b]);return d},d.child=function(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg",a);return b&&(c.innerHTML=b),d.appendChild(c),d},d.toFront=function(){return a.removeChild(d),a.appendChild(d),d},d.remove=function(){return d&&a.removeChild(d),d=null,null},d}function d(a){function b(){return q.length>2}function d(a){s=r,r=i(a),q.push(r),z?j():k()}function e(){w?m():(l(),E=E&&E.remove()),h(),ab.toFront()}function f(){E=E&&E.remove(),D=D&&D.remove(),C=C&&C.remove(),t=t&&t.remove(),h()}function g(){t=t&&t.remove()}function h(){for(var a=u.length-1;a>=0;a--)u.pop().remove()}function i(a){return I.x+=(a.x-r.x)/B,I.y+=(a.y-r.y)/B,I.x*=.5,I.y*=.5,{x:r.x+I.x,y:r.y+I.y}}function j(){var a=s.x-s.y<r.x-r.y?1:-1,b=Math.atan2(r.y-s.y,r.x-s.x);0===F.length&&(F.push({x:s.x-A*a/4,y:s.y-A*a/4}),G.push({x:s.x+A*a/4,y:s.y+A*a/4})),H=b>5*Math.PI/9||b<-Math.PI/9?H>.1?H-.05*H:H:b>Math.PI/9&&b<7*Math.PI/18?1.5>H?H+.05*H:H:1>H?H+.05*H:H>1?H-.05*H:1;var d=F[F.length-1],e=G[G.length-1],f={x:r.x-A*a*H/4,y:r.y-A*a*H/4},g={x:r.x+A*a*H/4,y:r.y+A*a*H/4},h=A/14,i=A/20,j=0===u.length?"C"+(e.x-h*a)+","+(e.y+i*a)+" "+(d.x-h*a)+","+(d.y+i*a)+" "+d.x+","+d.y+"z":" "+d.x+","+d.y+"z",k="M"+d.x+","+d.y+"L"+f.x+","+f.y+" "+g.x+","+g.y+" "+e.x+","+e.y+j;o="C"+(f.x+h*a)+","+(f.y-i*a)+" "+(g.x+h*a)+","+(g.y-i*a)+" "+g.x+","+g.y,0===u.length&&(p=j),E.attrs({d:"M"+f.x+","+f.y+o+"z"}),u.push(c(W,"path").attrs(v).attrs({d:k})),F.push(f),G.push(g)}function k(){var a="M"+s.x+","+s.y+"L"+r.x+","+r.y;w+=r.x+","+r.y+" ",u.push(c(W,"path").attrs(v).attrs({d:a}))}function l(){var a,b=F,d=G,e="M"+b[0].x+","+b[0].y+"L";for(a=0;a<b.length;a++)e+=b[a].x+","+b[a].y+" ";for(e+=o+"L",a=d.length-1;a>=0;a--)e+=d[a].x+","+d[a].y+" ";e+=p,D=c(W,"path").attrs(v).attrs({d:e})}function m(){C=c(W,"path").attrs(v).attrs({d:w})}function n(b){var d=q.length>5?q[5]:q[q.length-1],e=Math.atan2(d.y-a.y,d.x-a.x),f=a.x-x*Math.cos(e),g=a.y-x*Math.sin(e);t=c(W,"text").attrs({x:f,y:g,stroke:"none",fill:v.stroke,"font-size":y,style:"text-anchor: middle; font: "+y+"px Arial"}).child("tspan",b),ab.toFront()}var o,p,q=[a],r=a,s=null,t=null,u=[],v=T(Z),w=z?null:"M"+a.x+","+a.y+"L",C=null,D=null,E=z?c(W,"path").attrs(v):null,F=[],G=[],H=1,I={x:0,y:0};this.dots=q,this.addDot=d,this.validate=b,this.draw=e,this.drawNumber=n,this.wipe=f,this.wipeNumber=g}var e,f=localStorage.getItem("hw.grid"),g=localStorage.getItem("hw.calligraphy"),h=localStorage.getItem("hw.numbers"),i=localStorage.getItem("hw.color"),j=localStorage.getItem("hw.bg"),k=localStorage.getItem("hw.thickness"),l=localStorage.getItem("hw.smoothing"),m=document.getElementById("recogPaper"),n=m.clientWidth,o=m.clientHeight,p=["bg-none","bg-paper","bg-blackboard"],q=i&&"random"===i,r=!q&&i?i:"#444",s=f?"true"===f:!0,t="#000",u=3,v=3,w="true"===h,x=20,y=16,z=g?"true"===g:!0,A=k?+k:10,B=l?+l:5,C=function(){for(var a=[],b=u;b>=1;b--){for(var d=Math.pow(2,b),e=n/d,f=o/d,g="",h=1;d>h;h++){var i=Math.floor(e*h)+.5,j=Math.floor(f*h)+.5;g+="M"+i+" 0V"+o+"M0 "+j+"H"+n}var k=c(W,"path",!0).attrs({d:g,fill:"none",stroke:t,"stroke-width":1,"stroke-opacity":1/(d*v)});a.push(k)}return a},D=function(){0>_||e||($[_].wipe(),_-=1,F(),V())},E=function(){var a=$[_+1];a&&(_+=1,a.draw(),w&&a.drawNumber(_+1)),F(),V()},F=function(){0>_?(bb.classList.add("disabled"),db.classList.add("disabled")):(bb.classList.remove("disabled"),db.classList.remove("disabled")),_<$.length-1?cb.classList.remove("disabled"):cb.classList.add("disabled")},G=function(){for(var a=_;a>=0;a--)$[a].wipe();_=-1,F(),V()},H=function(){if(s)for(var a=X.length-1;a>=0;a--)X.pop().remove();else X=C();s=!s,O(this,s),localStorage.setItem("hw.grid",s)},I=function(){z=!z,Z=S(),O(this,z),localStorage.setItem("hw.calligraphy",z)},J=function(){w=!w;for(var a=0;_>=a;a++)w?$[a].drawNumber(a+1):$[a].wipeNumber();O(this,w),localStorage.setItem("hw.numbers",w)},K=function(){(new ColorPicker).showAtElement(this,L)},L=function(a){a&&("random"===a?(hb.classList.add("randomColorIcon"),hb.style.backgroundColor="transparent",q=!0,Y=R()):(hb.classList.remove("randomColorIcon"),hb.style.backgroundColor=a,q=!1,Y=a),S(),localStorage.setItem("hw.color",a))},M=function(){function a(a){var b=document.createElement("button");b.className="btn-bg "+a,b.onclick=function(){c.removePicker(),N(a)},c.appendChild(b)}for(var b=this.getBoundingClientRect(),c=JTOOLS.createPicker("bgPicker",b.left,this.offsetHeight+b.top),d=0;d<p.length;d++)a(p[d])},N=function(a){(!a||p.indexOf(a)<0)&&(a=p[0]);for(var b=/^bg-.*/,c=0;c<m.classList.length;c++)m.classList[c].match(b)&&m.classList.remove(m.classList[c]);"bg-none"!==a&&m.classList.add(a),ib.className=a,localStorage.setItem("hw.bg",a)},O=function(a,b){var c=a.classList;b?c.contains("active")||c.add("active"):c.contains("active")&&c.remove("active")},P=function(){A=jb.value,Z=S(),localStorage.setItem("hw.thickness",A)},Q=function(){B=kb.value,localStorage.setItem("hw.smoothing",B)},R=function(){var a=Math.floor(30+140*Math.random()),b=Math.floor(30+140*Math.random()),c=Math.floor(30+140*Math.random());return"rgb("+a+","+b+","+c+")"},S=function(){return Z||(Z={"stroke-linecap":"round","stroke-linejoin":"round"}),Z.fill=z?Y:"none",Z.stroke=Y,Z["stroke-width"]=z?A/2:A,Z},T=function(a){if(null==a||"object"!=typeof a)return a;var b=a.constructor();for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},U=function(){function a(a){var b=(0^a).toString(16);return 1===b.length?"0"+b:b}var b,c,d=Number.MAX_VALUE,e=Number.MAX_VALUE,f=Number.MIN_VALUE,g=Number.MIN_VALUE,h="";for(c=0;_>=c;c++)b=$[c].dots,b[0].x<d&&(d=b[0].x),b[0].y<e&&(e=b[0].y),b[0].x>f&&(f=b[0].x),b[0].y>g&&(g=b[0].y),b[b.length-1].x<d&&(d=b[b.length-1].x),b[b.length-1].y<e&&(e=b[b.length-1].y),b[b.length-1].x>f&&(f=b[b.length-1].x),b[b.length-1].y>g&&(g=b[b.length-1].y);0===d-f&&(d+=.01,f-=.01),0===e-g&&(e+=.01,g-=.01);var i,j=Math.abs(d-f),k=Math.abs(e-g);j>5*k?(i=(j-k)/2,e-=i,g+=i):k>5*j&&(i=(k-j)/2,d-=i,f+=i);var l,m,n,o;for(c=0;_>=c;c++)b=$[c].dots,l=255*(b[0].x-d)/(f-d),m=255*(b[0].y-e)/(g-e),n=255*(b[b.length-1].x-d)/(f-d),o=255*(b[b.length-1].y-e)/(g-e),h+=a(l)+a(m)+a(n)+a(o);return h},V=function(){a(U())},W=c(m,"svg",!1).attrs({width:n,height:o,version:"1.1",style:"overflow: hidden; position: relative;"}).child("desc","JTOOLS").child("defs"),X=s?C():[],Y=q?R():r,Z=S(),$=[],_=-1,ab=c(W,"rect").attrs({width:n,height:o,fill:"#000",stroke:"none","fill-opacity":0,"stroke-width":0}),bb=document.getElementById("btnUndo"),cb=document.getElementById("btnRedo"),db=document.getElementById("btnClear"),eb=document.getElementById("tglGrid"),fb=document.getElementById("tglCalligraphy"),gb=document.getElementById("tglNumbers"),hb=document.getElementById("btnColor"),ib=document.getElementById("btnBg"),jb=document.getElementById("sldThickness"),kb=document.getElementById("sldBrushMass");ab.onmousedown=function(a){function b(a){1===a.which&&e&&e.addDot({x:a.clientX-g.left,y:a.clientY-g.top})}function c(a){if(1===a.which&&e){if(!e.validate())return e.wipe(),e=null,f(),void 0;$[++_]=e,bb.classList.remove("disabled"),db.classList.remove("disabled"),e.draw(),w&&e.drawNumber(_+1),q&&(Y=R(),S()),_===$.length-1&&cb.classList.add("disabled"),e=null,V(),f()}}function f(){document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",c)}if(1===a.which){var g=m.getBoundingClientRect();return e=new d({x:a.clientX-g.left,y:a.clientY-g.top}),document.addEventListener("mousemove",b),document.addEventListener("mouseup",c),!1}},jb.setValue(A),jb.onchange=P,kb.setValue(B),kb.onchange=Q,bb.onclick=D,cb.onclick=E,db.onclick=G,eb.onclick=H,fb.onclick=I,gb.onclick=J,hb.onclick=K,ib.onclick=M,O(eb,s),O(fb,z),O(gb,w),L(i),N(j),m.addEventListener("contextmenu",function(a){return a.preventDefault(),D(),!1},!1),m.addEventListener("mousewheel",b,!1),m.addEventListener("DOMMouseScroll",b,!1)}function Keyboard(){function a(){n=!1,document.getElementById("outHiragana").className="output selected",document.getElementById("outKatakana").className="output",c("katakana","hiragana"),o.focus(),localStorage.setItem("kb.out","outHiragana")}function b(){n=!0,document.getElementById("outKatakana").className="output selected",document.getElementById("outHiragana").className="output",c("hiragana","katakana"),o.focus(),localStorage.setItem("kb.out","outKatakana")}function c(a,b){var c=o.selectionStart,e=o.selectionEnd,f=o.value;if(void 0!==c&&c!==f.length){var g=f.substring(0,c),h=f.substring(e,f.length),i=d(f.substring(c,e),a,b);o.value=g+i+h,o.selectionStart=c,o.selectionEnd=e}}function d(a,b,c){function d(a){var b;try{b=document.querySelector(a)}catch(c){}return b}for(var e="",f=0;f<a.length;f++){var g=a.charAt(f),h=d("button["+b+"="+g+"].symb");e+=h?h.getAttribute(c):g}return e}function e(){var c=document.getElementsByClassName("symb"),d=c.length,e=document.getElementsByClassName("aux selected");if(e[0]){if(e[0]===this)return;e[0].className="aux"}"katakana"===this.id?b():a(),this.className="aux selected";for(var f=0;d>f;f++)c[f].onclick||(c[f].onclick=g),c[f].innerHTML=c[f].getAttribute(this.id)||c[f].getAttribute("default");localStorage.setItem("kb.layout",this.id)}function f(a,b){return a.getAttribute(b)||a.getAttribute("default")}function g(a){h(a.shiftKey===n?f(this,"hiragana"):f(this,"katakana"))}function h(a){if(a){var b=o.selectionStart,c=o.selectionEnd;void 0!==b?(b===o.value.length?o.value+=a:o.value=o.value.slice(0,b)+a+o.value.slice(c),o.selectionEnd=o.selectionStart=b+a.length):o.value+=a,o.focus()}}function i(){h("　")}function j(){var a=o.selectionStart,b=o.selectionEnd;void 0!==a?a===b?a>0&&(o.value=o.value.slice(0,a-1)+o.value.slice(b),o.selectionEnd=o.selectionStart=a-1):(o.value=o.value.slice(0,a)+o.value.slice(b),o.selectionEnd=o.selectionStart=a):o.value=o.value.slice(0,-1),o.focus()}function k(){o.value="",o.focus()}function l(){function a(){var a="ん";o.value.charAt(e-2)!==g!==n&&(a="ン"),o.value=o.value.slice(0,e-2)+a+o.value.slice(e-1),o.selectionStart=o.selectionEnd=e}var b,c,e=o.selectionStart,f=o.value.charAt(e-3)&&o.value.charAt(e-3).toLowerCase(),g=o.value.charAt(e-2)&&o.value.charAt(e-2).toLowerCase(),h=o.value.charAt(e-1)&&o.value.charAt(e-1).toLowerCase(),i=p[f+g+h],j=p[g+h],k=p[h];i?(b=i,c=3):j?(b=j,c=2):k?(b=k,c=1,("n"===g.toLowerCase()||"н"===g.toLowerCase())&&a()):("n"===g.toLowerCase()&&"y"!==h.toLowerCase()||"н"===g.toLowerCase())&&a(),b&&(o.value.charAt(e-1)!==h!==n&&(b=d(b,"hiragana","katakana")),c>=e?(o.value=b+o.value.slice(e),o.selectionStart=o.selectionEnd=b.length):(o.value=o.value.slice(0,e-c)+b+o.value.slice(e),o.selectionStart=o.selectionEnd=e-c+b.length))}function m(){function a(a){function b(){for(var a=0;a<c.length;a++)c[a].className="w-kanji"+(a===e?" selected":"")}var c=document.getElementsByClassName("w-kanji");return c.length>0&&(a.preventDefault(),void 0===d?(e=0,b(),d=c[0].innerHTML):(e+=("wheelDelta"in a?a.wheelDelta:-a.detail)<0?1:-1,e>=c.length&&(e=0),0>e&&(e=c.length-1),b(),d=c[e].innerHTML)),!1}function b(){d=void 0,e=0}function c(a){var b,c;for(c=a.length-1;c>=0&&(b=a.charCodeAt(c),!(12353>b||b>12540));c--);return a.substr(0,c+1)}var d,e;document.addEventListener("mousedown",function(a){var e=document.getElementById("rikaichan-window")||document.getElementById("rikaichamp-window");return e&&e.innerHTML&&(0===a.button||1===a.button)&&d?(a.preventDefault(),h(a.button?c(d):d),b(),!1):void 0}),document.addEventListener("DOMMouseScroll",a,!1),document.addEventListener("mousewheel",a,!1),document.addEventListener("DOMNodeInserted",function(a){!d||"rikaichan-window"!==a.relatedNode.id&&"rikaichamp-window"!==a.relatedNode.id||b()}),document.addEventListener("DOMNodeRemoved",function(a){("rikaichan-window"===a.relatedNode.id||"rikaichamp-window"===a.relatedNode.id)&&document.getElementById("str").focus()})}var n,o,p={a:"あ",i:"い",u:"う",e:"え",o:"お",ka:"か",ki:"き",ku:"く",ke:"け",ko:"こ",sa:"さ",si:"し",su:"す",se:"せ",so:"そ",shi:"し",ta:"た",ti:"ち",tu:"つ",te:"て",to:"と",chi:"ち",tsu:"つ",na:"な",ni:"に",nu:"ぬ",ne:"ね",no:"の",ha:"は",hi:"ひ",hu:"ふ",he:"へ",ho:"ほ",fu:"ふ",ma:"ま",mi:"み",mu:"む",me:"め",mo:"も",ya:"や",yu:"ゆ",yo:"よ",ra:"ら",ri:"り",ru:"る",re:"れ",ro:"ろ",wa:"わ",wo:"を","n'":"ん",ga:"が",gi:"ぎ",gu:"ぐ",ge:"げ",go:"ご",za:"ざ",ji:"じ",zu:"ず",ze:"ぜ",zo:"ぞ",da:"だ",di:"ぢ",du:"づ",de:"で","do":"ど",ba:"ば",bi:"び",bu:"ぶ",be:"べ",bo:"ぼ",pa:"ぱ",pi:"ぴ",pu:"ぷ",pe:"ぺ",po:"ぽ",kya:"きゃ",kyu:"きゅ",kyo:"きょ",gya:"ぎゃ",gyu:"ぎゅ",gyo:"ぎょ",sya:"しゃ",syu:"しゅ",syo:"しょ",sha:"しゃ",shu:"しゅ",sho:"しょ",ja:"じゃ",ju:"じゅ",jo:"じょ",jya:"じゃ",jyu:"じゅ",jyo:"じょ",tya:"ちゃ",tyu:"ちゅ",tyo:"ちょ",cha:"ちゃ",chu:"ちゅ",cho:"ちょ",nya:"にゃ",nyu:"にゅ",nyo:"にょ",hya:"ひゃ",hyu:"ひゅ",hyo:"ひょ",bya:"びゃ",byu:"びゅ",byo:"びょ",pya:"ぴゃ",pyu:"ぴゅ",pyo:"ぴょ",mya:"みゃ",myu:"みゅ",myo:"みょ",rya:"りゃ",ryu:"りゅ",ryo:"りょ",kk:"っk",gg:"っg",ss:"っs",zz:"っz",tt:"っt",dd:"っd",hh:"っh",ff:"っf",bb:"っb",pp:"っp",fa:"ふぁ",fi:"ふぃ",fe:"ふぇ",fo:"ふぉ","а":"あ","и":"い","у":"う","э":"え","о":"お","е":"え","й":"い","ка":"か","ки":"き","ку":"く","кэ":"け","ко":"こ","ке":"け","са":"さ","си":"し","су":"す","сэ":"せ","со":"そ","се":"せ","та":"た","ти":"ち","цу":"つ","тэ":"て","то":"と","те":"て","на":"な","ни":"に","ну":"ぬ","нэ":"ね","но":"の","не":"ね","ха":"は","хи":"ひ","фу":"ふ","хэ":"へ","хо":"ほ","хе":"へ","ма":"ま","ми":"み","му":"む","мэ":"め","мо":"も","ме":"め","я":"や","ю":"ゆ","ё":"よ","ра":"ら","ри":"り","ру":"る","рэ":"れ","ро":"ろ","ре":"れ","ва":"わ","-ва":"は","во":"を","-о":"を","нъ":"ん","га":"が","ги":"ぎ","гу":"ぐ","гэ":"げ","го":"ご","ге":"げ","дза":"ざ","дзи":"じ","дзу":"ず","дзэ":"ぜ","дзо":"ぞ","дзе":"ぜ","за":"ざ","зи":"じ","зу":"ず","зэ":"ぜ","зо":"ぞ","зе":"ぜ","да":"だ","дэ":"で","до":"ど","де":"で","ба":"ば","би":"び","бу":"ぶ","бэ":"べ","бо":"ぼ","бе":"べ","па":"ぱ","пи":"ぴ","пу":"ぷ","пэ":"ぺ","по":"ぽ","пе":"ぺ","кя":"きゃ","кю":"きゅ","кё":"きょ","гя":"ぎゃ","гю":"ぎゅ","гё":"ぎょ","ся":"しゃ","сю":"しゅ","сё":"しょ","дзя":"じゃ","дзю":"じゅ","дзё":"じょ","зя":"じゃ","зю":"じゅ","зё":"じょ","тя":"ちゃ","тю":"ちゅ","тё":"ちょ","ня":"にゃ","ню":"にゅ","нё":"にょ","хя":"ひゃ","хю":"ひゅ","хё":"ひょ","бя":"びゃ","бю":"びゅ","бё":"びょ","пя":"ぴゃ","пю":"ぴゅ","пё":"ぴょ","мя":"みゃ","мю":"みゅ","мё":"みょ","ря":"りゃ","рю":"りゅ","рё":"りょ",":":"う","кк":"っк","гг":"っг","сс":"っс","тт":"っт","цц":"っц","дд":"っд","хх":"っх","фф":"っф","бб":"っб","пп":"っп","фа":"ふぁ","фи":"ふぃ","фэ":"ふぇ","фо":"ふぉ","фе":"ふぇ","--":"ー",_:"ー","~":"～"," ":"　",",":"、",".":"。","!":"！","?":"？","%":"％","[":"【","]":"】","\\":"＼","/":"／",0:"０",1:"１",2:"２",3:"３",4:"４",5:"５",6:"６",7:"７",8:"８",9:"９"};this.addSymbol=h,document.getElementById("outHiragana").onclick=a,document.getElementById("outKatakana").onclick=b,document.getElementById("hiragana").onclick=e,document.getElementById("katakana").onclick=e,document.getElementById("romaji").onclick=e,document.getElementById("kiriji").onclick=e,document.getElementById("space").onclick=i,document.getElementById("backspace").onclick=j,document.getElementById("clear").onclick=k,o=document.getElementById("str"),o.oninput=l;var q=localStorage.getItem("kb.out.height");!q||navigator.userAgent.lastIndexOf("Chrome/")>0||(o.style.height=q),o.addEventListener("mousedown",function(){q=o.style.height}),document.addEventListener("mouseup",function(){o.style.height!==q&&localStorage.setItem("kb.out.height",o.style.height)}),o.focus();var r=localStorage.getItem("kb.out"),s=localStorage.getItem("kb.layout");document.getElementById(s?s:"hiragana").onclick(),document.getElementById(r?r:"outHiragana").onclick(),m()}function Panels(){function a(a,b){if(a.length)for(var c=0;c<a.length;c++)a[c].onclick=b}function b(a,b){var c=document.getElementById(a),e=document.getElementsByClassName("trigger-"+a);c?(c.style.display="block",c.classList.remove("animate-fade-out"),c.classList.add("animate-fade-in"),d(c)):b();for(var f=0;f<e.length;f++)e[f].classList.add("on")}function c(a){var b=document.getElementById(a),c=document.getElementsByClassName("trigger-"+a);if(b){for(var d=0;d<c.length;d++)c[d].classList.remove("on");b.classList.remove("animate-fade-in"),b.classList.add("animate-fade-out"),setTimeout(function(){b.style.display="none"},90)}localStorage.removeItem(a+".z")}function d(a){f.splice(f.indexOf(a),1),f.unshift(a),e()}function e(){for(var a=0;a<f.length;a++)f[a].style.zIndex=f.length-a,localStorage.setItem(f[a].id+".z",f[a].style.zIndex)}var f=[],g={},h=!1,i=document.getElementById("container"),j=function(a,b,c){var g=document.createElement("div");return g.style.display="none",g.id=a,g.className="panel animate-fade-in",g.style.left=b?b:"15%",g.style.top=c?c:"15%",i.appendChild(g),setDraggable(g),f.unshift(g),g.addEventListener("mousedown",function(){d(g)}),e(),g},k=function(a){a&&(i.removeChild(a),f.splice(f.indexOf(a),1),localStorage.removeItem(a.id+".z"))};return{initPanel:function(d,e){g[d]=e,localStorage.getItem(d+".z")&&(b(d,e),h=!0),a(document.getElementsByClassName("trigger-"+d),function(){var a=document.getElementById(d),f=!a||"none"===a.style.display;f?b(d,e):c(d)})},hasSavedPanes:function(){return h},loadPanel:function(a){g[a]&&g[a]()},createPanel:j,removePanel:k,createPicker:function(a,b,c){function d(){e.removeEventListener("mousedown",f),document.removeEventListener("mousedown",d),k(e),e=null}var e=j(a,b+"px",c+"px"),f=function(a){a.stopPropagation()};return e.addEventListener("mousedown",f),document.addEventListener("mousedown",d),e.removePicker=d,e.style.display="block",e}}}function Recognition(a,b){function c(a,b){function c(){if(b=b.replace(/x/g,"00").replace(/y/g,"ff"),0===b.length%8){var a=b.length/8;for(f=0;a>f;f++){g=b.substr(8*f,8);var c=parseInt(g.substr(0,2),16),m=parseInt(g.substr(2,2),16),n=parseInt(g.substr(4,2),16),o=parseInt(g.substr(6,2),16);h[f]=[c,m,n,o],i.push(d(c,m)),j.push(d(n,o)),k.push(e(c,m,n,o)),f>0&&l.push(e(h[f-1][2],h[f-1][3],c,m))}}}var f,g,h=[],i=[],j=[],k=[],l=[];this.symbol=a,this.strokes=h,this.strokeStarts=i,this.strokeEnds=j,this.strokeDirections=k,this.moveDirections=l,b&&c()}function d(a,b){return 85>a?85>b?j.NW:170>b?j.W:j.SW:170>a?85>b?j.N:170>b?j.MID:j.S:85>b?j.NE:170>b?j.E:j.SE}function e(a,b,c,d){var e,f=c-a,g=d-b,h=Math.abs(f),i=Math.abs(g);return l>h&&l>i?k.X:h>i?(e=i>m*h>>8,f>0?e?0>g?k.NE:k.SE:k.E:e?0>g?k.NW:k.SW:k.W):(e=h>m*i>>8,g>0?e?0>f?k.SW:k.SE:k.S:e?0>f?k.NW:k.NE:k.N)}function f(a){function b(a){for(var b=a.strokeStarts,c=a.strokeEnds,d=a.strokeDirections,i=a.moveDirections,l=0,m=0;m<e.length;m++)g[m]===d[m]?l+=n:k.isClose(g[m],d[m])&&(l+=n*q),m>0&&(h[m-1]===i[m-1]?l+=o:k.isClose(h[m-1],i[m-1])&&(l+=o*q)),e[m]===b[m]?l+=p:j.isClose(e[m],b[m])&&(l+=p*q),f[m]===c[m]?l+=p:j.isClose(f[m],c[m])&&(l+=p*q);var r=e.length*(n+2*p)+(e.length-1)*o;return 100*l/r}var c=[],d=i[a.strokes.length],e=a.strokeStarts,f=a.strokeEnds,g=a.strokeDirections,h=a.moveDirections;for(var l in d)if(d.hasOwnProperty(l)){var m=b(d[l]),s=d[l].symbol;c.push({symbol:s,score:m})}return c.sort(function(a,b){return a.score>b.score?-1:a.score<b.score?1:0}),c.slice(0,r)}function g(a){for(var c=0;r>c;c++){var d=document.createElement("div");d.classList.add("output-item"),d.classList.add("no-drag"),d.onclick=function(a){a.preventDefault(),b(this.innerHTML)},a.appendChild(d)}}var h="0.3",i={},j={N:[1,0],NE:[2,0],E:[2,1],SE:[2,2],S:[1,2],SW:[0,2],W:[0,1],NW:[0,0],MID:[1,1],isClose:function(a,b){return Math.abs(a[0]-b[0])<=1&&Math.abs(a[1]-b[1])<=1}},k={N:0,NE:1,E:2,SE:3,S:4,SW:5,W:6,NW:7,X:-1,isClose:function(a,b){return a===k.X||b===k.X||a===b?!0:a===(b+1)%8||(a+1)%8===b}},l=51,m=77,n=1,o=.8,p=.6,q=.7,r=8,s=document.getElementById("output-strict"),t=document.getElementById("output-fuzzy"),u=document.getElementById("output-plus-minus-1"),v=document.getElementById("output-plus-minus-2");g(s),g(t),g(u),g(v),this.kanjis=i,function(){function b(){sendRequest("data/recog-"+h+".txt",function(a){localStorage.setItem("recog",a),localStorage.setItem("recog_version",h),d(JSON.parse(a))})}function d(b){var d=0,e=Object.keys(b).length,f=5,g=0^e/(100/f);for(var h in b)if(b.hasOwnProperty(h)){var j=new c(h,b[h]),k=i[j.strokes.length];k||(k={},i[j.strokes.length]=k),k[j.symbol]=j,a&&0===d%g&&a(0^f*d/g),d++}}var e=localStorage.getItem("recog"),f=localStorage.getItem("recog_version");if(null!==e)if(f!==h)b();else try{d(JSON.parse(e))}catch(g){b()}else b()}(),this.recognize=function(a){for(var b=new c("?",a),d=f(b),e=0;e<s.children.length;e++)s.children[e].innerHTML=d[e]?d[e].symbol:""}}function Sliders(){function a(a){function o(a){return q(a),document.addEventListener("mousemove",q),document.addEventListener("mouseup",p),!1}function p(){return document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",p),!1}function q(a){var b=r(a,B),c=b*(N-M)/(F-G)+M;if(O>0){var d=c%O;c+=d>O/2?O-d:-d}return s(M>c?M:c>N?N:c),!1}function r(a,b){var c=Math.sin(P),d=Math.cos(P),e=0>d?b.getBoundingClientRect().right:b.getBoundingClientRect().left,f=0>c?b.getBoundingClientRect().bottom:b.getBoundingClientRect().top,g=a.clientX-e-G/2*(0>d?-1:1),h=a.clientY-f-G/2*(0>c?-1:1);return g*d+h*c}function s(b){b>N?b=N:M>b&&(b=M),C.style.left=(b-M)*(F-G)/(N-M)+"px",a.value=b,C.innerHTML=Q?Math.round(b):"&nbsp;",a.onchange&&a.onchange()}function t(){s(+a.value+(O>0?O:1))}function u(){s(a.value-(O>0?O:1))}function v(a){return window.getComputedStyle?getComputedStyle(a,null):a.currentStyle}function w(a,b){var c=parseInt(a);return c?c:b}function x(a){for(var b=document.documentElement,c=0;c<a.length;c++)if("string"==typeof b.style[a[c]])return a[c];return null}function y(a,b,c){"undefined"!=typeof b&&(a.style[b]=c)}function z(a){var b=0;return b="wheelDelta"in a?a.wheelDelta:-a.detail,b>0?t():u(),a.preventDefault(),!1}var A=a.id,B=document.createElement("div"),C=document.createElement("div");a.parentElement.insertBefore(B,a),B.appendChild(C),B.className="no-drag slit "+A+"-slit",C.className="no-drag knob "+A+"-knob";var D=v(B),E=v(C),F=w(D.width,e),G=(w(D.height,f),w(E.width,g)),H=w(E.height,h),I="none"!==D.backgroundImage?D.backgroundImage:i,J="none"!==E.backgroundImage?E.backgroundImage:j,K="auto"!==D.cursor?D.cursor:"pointer",L=parseInt(E.fontSize),M=parseFloat(a.getAttribute("min")),N=parseFloat(a.getAttribute("max")),O=parseFloat(a.getAttribute("step")),P=parseInt(a.getAttribute("angle"))%360*Math.PI/180,Q=parseInt(a.getAttribute("showvalue"));G>=F&&(F=e,B.style.width=F+"px",G=g,C.style.width=G+"px"),this.setValue=s,this.valueUp=t,this.valueDown=u,isNaN(M)&&(M=b),isNaN(N)&&(N=c),M>N&&(N=M),isNaN(O)&&(O=d),O>N&&(O=N),isNaN(P)&&(P=l),isNaN(Q)&&(Q=n),Q&&(0==L||H>L||isNaN(L))&&(L=k);var R=x(["transform","MozTransform","WebkitTransform","msTransform","OTransform"]),S=x(["transformOrigin","MozTransformOrigin","WebkitTransformOrigin","msTransformOrigin","OTransformOrigin"]);a.style.display="none",B.style.backgroundImage=I,B.style.display="inline-block",B.style.cursor=K,B.title=a.title,y(B,R,"rotate("+P+"rad)"),y(B,S,m),C.style.backgroundImage=J,C.style.position="relative",C.style.lineHeight=H+"px",C.style.textAlign="center",C.style.fontSize=L,a.defaultValue&&a.defaultValue>=M&&a.defaultValue<=N?s(a.defaultValue):s(M),B.addEventListener("mousewheel",z,!1),B.addEventListener("DOMMouseScroll",z,!1),B.onmousedown=o}var b=0,c=20,d=1,e=140,f=16,g=19,h=16,i="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIwAAAAQAQMAAAD+qgVFAAAAAXNSR0IArs4c6QAAAAZQTFRFmZmZ5+fnAKzB3gAAABRJREFUGNNjYMAE9f/RwIORKoQJAL0q8lNkiT1EAAAAAElFTkSuQmCC)",j="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAAQBAMAAAAG6llRAAAAAXNSR0IArs4c6QAAABVQTFRFlJSU1tbe1tbWzs7W9/f3tbW1597nN/SE2wAAADFJREFUCNdjCIWBAIYQFyhwYAhJg4IAKjMFoQDIVIICIFNZyQiElIFMYyhAYQYwwAAAVWUuIsQq8ZQAAAAASUVORK5CYII=)",k="10px",l=0,m="50% 50%",n=1;!function(){for(var b=document.querySelectorAll("input[type=slider]"),c=0;c<b.length;c++){var d=b[c],e=new a(d);d.setValue=e.setValue,d.valueUp=e.valueUp,d.valueDown=e.valueDown}}()}!function(){function a(){for(var a=!1,c=0;c<b.length;c++){try{a=b[c]()}catch(d){continue}break}return a}window.sendRequest=function(b,c,d){var e=a();if(e){var f=d?"POST":"GET";e.open(f,b,!0),d&&e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){return 4===e.readyState?200!==e.status&&304!==e.status?(message("HTTP error. Something went wrong in server side.","error"),void 0):(c(e.responseText),void 0):void 0},4!==e.readyState&&e.send(d)}};var b=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}]}();var JTOOLS={};window.addEventListener("load",onLoad),window.debug=document.getElementById("debug");var DRAG_TAGS_IGNORE=["textarea","button","canvas","input","rect"];